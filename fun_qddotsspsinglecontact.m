function qddot = fun_qddotsspsinglecontact(x,u,dt)
%%%% SSP phase- 1   %%%%%%%%%%%%%%


global A B Nx Nu pert MI L m  nx ny tx ty g r lam vars misc alp alpval indic kc lamall xdata lamx lamy val af acal fx fy Mmat2


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
m1 = m(1);
m2 = m(2);
m3 = m(3);
m4 = m(4);
m5 = m(5);
m6 = m(6);
m7 = m(7);

%L1 = L(1);
L2 = L(1);
L3 = L(2);
%L4 = L(4);
L5 = L(3);
L6 = L(4);

%r1 = ra(1);% trunk
r2 = r(1);
r3 = r(2);
%r4 = ra(4);
r5 = r(3);
r6 = r(4);
%r7 = ra(7);

MI1 = MI(1);
MI2 = MI(2);
MI3 = MI(3);
MI4 = MI(4);
MI5 = MI(5);
MI6 = MI(6);
MI7 = MI(7);
R2 = misc(1);
R3 = misc(2);
%R2 = 0.4028;
%R3 = 0.4061;
del2 = misc(3);
del3 = misc(4);
%del2 = deg2rad(1.142);
%del3 = deg2rad(1.20);
gamma61 = misc(5);
gamma62 = misc(6);
gamma71 = misc(7);
gamma72 = misc(8);
r4 = vars(1);
r7 = vars(2);
r4t = vars(3);
r4h = vars(4);

%M= 0;
d1 = 0.1081;
d3 = 0.0682;
h4 = 0.0437;
h2 = 0.0722;
r4c =  vars(5)   %0.1638;
% 0.0872 new value considering lycop = 0
gamma43 =  vars(6) % 2.3752 ;  
% 2.6481 new value considering lycop = 0


%{
tht1 = xdata(1);
tht2 = xdata(2);
tht3 = xdata(3);
tht4 = xdata(4);
tht5 = xdata(5);
tht6 = xdata(6);
tht7 = xdata(7);
x1   = xdata(8);
y1   = xdata(9);
omg1 = xdata(10);
omg2 = xdata(11);
omg3 = xdata(12);
omg4 = xdata(13);
omg5 = xdata(14);
omg6 = xdata(15);
omg7 = xdata(16);
vhx = xdata(17);
vhy = xdata(18);

%}

tht1 = x(3);
tht2 = x(4);
tht3 = x(5);
tht4 = x(6);
tht5 = x(7);
tht6 = x(8);
tht7 = x(9);
x1   = x(1);
y1   = x(2);
omg1 = x(12);
omg2 = x(13);
omg3 = x(14);
omg4 = x(15);
omg5 = x(16);
omg6 = x(17);
omg7 = x(18);
vhx = x(10);
vhy = x(11);

%{
alp1 = alp(3);
alp2 = alp(4);
alp3 = alp(5);
alp4 = alp(6);
alp5 = alp(7);
alp6 = alp(8);
alp7 = alp(9);
ax1 =  alp(1);
ay1 =  alp(2);
%}
T1  =  u(1);
T2  =  u(2);
T3  =  u(3);
T4  =  u(4);
T5  =  u(5);
T6  =  u(6);
T7  =  u(7);
c = -1.6;
%T1  = u(1);
%{
T2  = c*omg2*r2 +u(1);
T3  = c*omg3*r3 +u(2);
T4  = c*omg4*r4 +u(3);
T5  = c*omg5*r5 +u(4);
T6  = c*omg6*r6 +u(5);
T7  = c*omg7*r7 +u(6);
%}
lam1 = lamy;
lam2 =lamx;
%{
T2  = -c*omg2*r2 +u(1);
T3  = -c*omg3*r3 +u(2);
T4  = -MI4*alp4  -c*omg4*r4 +u(3);
T5  = -c*omg5*r5 +u(4);
T6  = -c*omg6*r6 +u(5);
T7  = -c*omg7*r7 +u(6);

%}

%T4  =  c*omg4 ;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Finding external forces

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Mmat=[m1+m2+m3+m4+m5+m6+m7,0,(-1).*m1.*r1.*sin(tht1),(-1).*L2.*m1.*sin( ...
  tht2)+(-1).*L2.*m5.*sin(tht2)+(-1).*L2.*m6.*sin(tht2)+(-1).*L2.* ...
  m7.*sin(tht2)+(-1).*m2.*r2.*sin(tht2),(-1).*L3.*m1.*sin(tht3)+(-1) ...
  .*L3.*m2.*sin(tht3)+(-1).*L3.*m5.*sin(tht3)+(-1).*L3.*m6.*sin( ...
  tht3)+(-1).*L3.*m7.*sin(tht3)+(-1).*m3.*r3.*sin(tht3),(-1).*m4.* ...
  r14.*sin(gamma1+tht4)+(-1).*L4.*m1.*sin(gamma2+tht4)+(-1).*L4.* ...
  m2.*sin(gamma2+tht4)+(-1).*L4.*m3.*sin(gamma2+tht4)+(-1).*L4.*m5.* ...
  sin(gamma2+tht4)+(-1).*L4.*m6.*sin(gamma2+tht4)+(-1).*L4.*m7.*sin( ...
  gamma2+tht4),L5.*m6.*sin(tht5)+L5.*m7.*sin(tht5)+m5.*r5.*sin(tht5) ...
  ,L6.*m7.*sin(tht6)+m6.*r6.*sin(tht6),(-1).*m7.*r74.*sin(beta1+ ...
  tht7)+L7.*m7.*sin(beta2+tht7);0,m1+m2+m3+m4+m5+m6+m7,m1.*r1.*cos( ...
  tht1),L2.*m1.*cos(tht2)+L2.*m5.*cos(tht2)+L2.*m6.*cos(tht2)+L2.* ...
  m7.*cos(tht2)+m2.*r2.*cos(tht2),L3.*m1.*cos(tht3)+L3.*m2.*cos( ...
  tht3)+L3.*m5.*cos(tht3)+L3.*m6.*cos(tht3)+L3.*m7.*cos(tht3)+m3.* ...
  r3.*cos(tht3),m7.*r74.*cos(beta1+tht4)+m4.*r14.*cos(gamma1+tht4)+ ...
  L4.*m1.*cos(gamma2+tht4)+L4.*m2.*cos(gamma2+tht4)+L4.*m3.*cos( ...
  gamma2+tht4)+L4.*m5.*cos(gamma2+tht4)+L4.*m6.*cos(gamma2+tht4)+ ...
  L4.*m7.*cos(gamma2+tht4),(-1).*L5.*m6.*cos(tht5)+(-1).*L5.*m7.* ...
  cos(tht5)+(-1).*m5.*r5.*cos(tht5),(-1).*L6.*m7.*cos(tht6)+(-1).* ...
  m6.*r6.*cos(tht6),(-1).*L7.*m7.*cos(beta2+tht7);(-1).*m1.*r1.*sin( ...
  tht1),m1.*r1.*cos(tht1),MI1+m1.*r1.^2,L2.*m1.*r1.*cos(tht1+(-1).* ...
  tht2),L3.*m1.*r1.*cos(tht1+(-1).*tht3),L4.*m1.*r1.*cos(gamma2+(-1) ...
  .*tht1+tht4),0,0,0;(-1).*(L2.*(m1+m5+m6+m7)+m2.*r2).*sin(tht2),( ...
  L2.*(m1+m5+m6+m7)+m2.*r2).*cos(tht2),L2.*m1.*r1.*cos(tht1+(-1).* ...
  tht2),L2.^2.*m1+L2.^2.*m5+L2.^2.*m6+L2.^2.*m7+MI2+m2.*r2.^2,L2.* ...
  L3.*m1.*cos(tht2+(-1).*tht3)+L2.*L3.*m5.*cos(tht2+(-1).*tht3)+L2.* ...
  L3.*m6.*cos(tht2+(-1).*tht3)+L2.*L3.*m7.*cos(tht2+(-1).*tht3)+L3.* ...
  m2.*r2.*cos(tht2+(-1).*tht3),(1/2).*L2.*m7.*r74.*cos(beta1+(-1).* ...
  tht2+tht4)+L2.*L4.*m1.*cos(gamma2+(-1).*tht2+tht4)+L2.*L4.*m5.* ...
  cos(gamma2+(-1).*tht2+tht4)+L2.*L4.*m6.*cos(gamma2+(-1).*tht2+ ...
  tht4)+L2.*L4.*m7.*cos(gamma2+(-1).*tht2+tht4)+L4.*m2.*r2.*cos( ...
  gamma2+(-1).*tht2+tht4)+(1/2).*L2.*m7.*r74.*cos(beta1+tht2+tht4),( ...
  -1).*L2.*L5.*m6.*cos(tht2+(-1).*tht5)+(-1).*L2.*L5.*m7.*cos(tht2+( ...
  -1).*tht5)+(-1).*L2.*m5.*r5.*cos(tht2+(-1).*tht5),(-1).*L2.*L6.* ...
  m7.*cos(tht2+(-1).*tht6)+(-1).*L2.*m6.*r6.*cos(tht2+(-1).*tht6),( ...
  1/2).*L2.*m7.*r74.*cos(beta1+(-1).*tht2+tht7)+(-1).*L2.*L7.*m7.* ...
  cos(beta2+(-1).*tht2+tht7)+(-1/2).*L2.*m7.*r74.*cos(beta1+tht2+ ...
  tht7);(-1).*(L3.*(m1+m2+m5+m6+m7)+m3.*r3).*sin(tht3),(L3.*(m1+m2+ ...
  m5+m6+m7)+m3.*r3).*cos(tht3),L3.*m1.*r1.*cos(tht1+(-1).*tht3),L2.* ...
  L3.*m1.*cos(tht2+(-1).*tht3)+L2.*L3.*m5.*cos(tht2+(-1).*tht3)+L2.* ...
  L3.*m6.*cos(tht2+(-1).*tht3)+L2.*L3.*m7.*cos(tht2+(-1).*tht3)+L3.* ...
  m2.*r2.*cos(tht2+(-1).*tht3),L3.^2.*m1+L3.^2.*m2+L3.^2.*m5+L3.^2.* ...
  m6+L3.^2.*m7+MI3+m3.*r3.^2,(1/2).*L3.*m7.*r74.*cos(beta1+(-1).* ...
  tht3+tht4)+L3.*L4.*m1.*cos(gamma2+(-1).*tht3+tht4)+L3.*L4.*m2.* ...
  cos(gamma2+(-1).*tht3+tht4)+L3.*L4.*m5.*cos(gamma2+(-1).*tht3+ ...
  tht4)+L3.*L4.*m6.*cos(gamma2+(-1).*tht3+tht4)+L3.*L4.*m7.*cos( ...
  gamma2+(-1).*tht3+tht4)+L4.*m3.*r3.*cos(gamma2+(-1).*tht3+tht4)+( ...
  1/2).*L3.*m7.*r74.*cos(beta1+tht3+tht4),(-1).*L3.*L5.*m6.*cos( ...
  tht3+(-1).*tht5)+(-1).*L3.*L5.*m7.*cos(tht3+(-1).*tht5)+(-1).*L3.* ...
  m5.*r5.*cos(tht3+(-1).*tht5),(-1).*L3.*L6.*m7.*cos(tht3+(-1).* ...
  tht6)+(-1).*L3.*m6.*r6.*cos(tht3+(-1).*tht6),(1/2).*L3.*m7.*r74.* ...
  cos(beta1+(-1).*tht3+tht7)+(-1).*L3.*L7.*m7.*cos(beta2+(-1).*tht3+ ...
  tht7)+(-1/2).*L3.*m7.*r74.*cos(beta1+tht3+tht7);(-1).*m4.*r14.* ...
  sin(gamma1+tht4)+(-1).*L4.*(m1+m2+m3+m5+m6+m7).*sin(gamma2+tht4), ...
  m7.*r74.*cos(beta1+tht4)+m4.*r14.*cos(gamma1+tht4)+L4.*(m1+m2+m3+ ...
  m5+m6+m7).*cos(gamma2+tht4),L4.*m1.*r1.*cos(gamma2+(-1).*tht1+ ...
  tht4),(1/2).*L2.*m7.*r74.*cos(beta1+(-1).*tht2+tht4)+L2.*L4.*m1.* ...
  cos(gamma2+(-1).*tht2+tht4)+L2.*L4.*m5.*cos(gamma2+(-1).*tht2+ ...
  tht4)+L2.*L4.*m6.*cos(gamma2+(-1).*tht2+tht4)+L2.*L4.*m7.*cos( ...
  gamma2+(-1).*tht2+tht4)+L4.*m2.*r2.*cos(gamma2+(-1).*tht2+tht4)+( ...
  1/2).*L2.*m7.*r74.*cos(beta1+tht2+tht4),(1/2).*L3.*m7.*r74.*cos( ...
  beta1+(-1).*tht3+tht4)+L3.*L4.*m1.*cos(gamma2+(-1).*tht3+tht4)+ ...
  L3.*L4.*m2.*cos(gamma2+(-1).*tht3+tht4)+L3.*L4.*m5.*cos(gamma2+( ...
  -1).*tht3+tht4)+L3.*L4.*m6.*cos(gamma2+(-1).*tht3+tht4)+L3.*L4.* ...
  m7.*cos(gamma2+(-1).*tht3+tht4)+L4.*m3.*r3.*cos(gamma2+(-1).*tht3+ ...
  tht4)+(1/2).*L3.*m7.*r74.*cos(beta1+tht3+tht4),L4.^2.*m1+L4.^2.* ...
  m2+L4.^2.*m3+L4.^2.*m5+L4.^2.*m6+L4.^2.*m7+MI4+m4.*r14.^2+(1/2).* ...
  m7.*r74.^2+L4.*m7.*r74.*cos(beta1+(-1).*gamma2)+(1/2).*m7.* ...
  r74.^2.*cos(2.*(beta1+tht4))+L4.*m7.*r74.*cos(beta1+gamma2+2.* ...
  tht4),(-1/2).*L5.*m7.*r74.*cos(beta1+tht4+(-1).*tht5)+(-1).*L4.* ...
  L5.*m6.*cos(gamma2+tht4+(-1).*tht5)+(-1).*L4.*L5.*m7.*cos(gamma2+ ...
  tht4+(-1).*tht5)+(-1).*L4.*m5.*r5.*cos(gamma2+tht4+(-1).*tht5)+( ...
  -1/2).*L5.*m7.*r74.*cos(beta1+tht4+tht5),(-1/2).*L6.*m7.*r74.*cos( ...
  beta1+tht4+(-1).*tht6)+(-1).*L4.*L6.*m7.*cos(gamma2+tht4+(-1).* ...
  tht6)+(-1).*L4.*m6.*r6.*cos(gamma2+tht4+(-1).*tht6)+(-1/2).*L6.* ...
  m7.*r74.*cos(beta1+tht4+tht6),(-1/2).*L7.*m7.*r74.*cos(beta1+(-1) ...
  .*beta2+tht4+(-1).*tht7)+(1/2).*L4.*m7.*r74.*cos(beta1+(-1).* ...
  gamma2+(-1).*tht4+tht7)+(-1).*L4.*L7.*m7.*cos(beta2+(-1).*gamma2+( ...
  -1).*tht4+tht7)+(-1/2).*L7.*m7.*r74.*cos(beta1+beta2+tht4+tht7)+( ...
  -1/2).*L4.*m7.*r74.*cos(beta1+gamma2+tht4+tht7);(L5.*(m6+m7)+m5.* ...
  r5).*sin(tht5),(-1).*(L5.*(m6+m7)+m5.*r5).*cos(tht5),0,(-1).*L2.* ...
  L5.*m6.*cos(tht2+(-1).*tht5)+(-1).*L2.*L5.*m7.*cos(tht2+(-1).* ...
  tht5)+(-1).*L2.*m5.*r5.*cos(tht2+(-1).*tht5),(-1).*L3.*L5.*m6.* ...
  cos(tht3+(-1).*tht5)+(-1).*L3.*L5.*m7.*cos(tht3+(-1).*tht5)+(-1).* ...
  L3.*m5.*r5.*cos(tht3+(-1).*tht5),(-1/2).*L5.*m7.*r74.*cos(beta1+ ...
  tht4+(-1).*tht5)+(-1).*L4.*L5.*m6.*cos(gamma2+tht4+(-1).*tht5)+( ...
  -1).*L4.*L5.*m7.*cos(gamma2+tht4+(-1).*tht5)+(-1).*L4.*m5.*r5.* ...
  cos(gamma2+tht4+(-1).*tht5)+(-1/2).*L5.*m7.*r74.*cos(beta1+tht4+ ...
  tht5),L5.^2.*m6+L5.^2.*m7+MI5+m5.*r5.^2,L5.*L6.*m7.*cos(tht5+(-1) ...
  .*tht6)+L5.*m6.*r6.*cos(tht5+(-1).*tht6),(-1/2).*L5.*m7.*r74.*cos( ...
  beta1+(-1).*tht5+tht7)+L5.*L7.*m7.*cos(beta2+(-1).*tht5+tht7)+( ...
  1/2).*L5.*m7.*r74.*cos(beta1+tht5+tht7);(L6.*m7+m6.*r6).*sin(tht6) ...
  ,(-1).*(L6.*m7+m6.*r6).*cos(tht6),0,(-1).*L2.*L6.*m7.*cos(tht2+( ...
  -1).*tht6)+(-1).*L2.*m6.*r6.*cos(tht2+(-1).*tht6),(-1).*L3.*L6.* ...
  m7.*cos(tht3+(-1).*tht6)+(-1).*L3.*m6.*r6.*cos(tht3+(-1).*tht6),( ...
  -1/2).*L6.*m7.*r74.*cos(beta1+tht4+(-1).*tht6)+(-1).*L4.*L6.*m7.* ...
  cos(gamma2+tht4+(-1).*tht6)+(-1).*L4.*m6.*r6.*cos(gamma2+tht4+(-1) ...
  .*tht6)+(-1/2).*L6.*m7.*r74.*cos(beta1+tht4+tht6),L5.*L6.*m7.*cos( ...
  tht5+(-1).*tht6)+L5.*m6.*r6.*cos(tht5+(-1).*tht6),L6.^2.*m7+MI6+ ...
  m6.*r6.^2,(-1/2).*L6.*m7.*r74.*cos(beta1+(-1).*tht6+tht7)+L6.*L7.* ...
  m7.*cos(beta2+(-1).*tht6+tht7)+(1/2).*L6.*m7.*r74.*cos(beta1+tht6+ ...
  tht7);m7.*((-1).*r74.*sin(beta1+tht7)+L7.*sin(beta2+tht7)),(-1).* ...
  L7.*m7.*cos(beta2+tht7),0,(-1).*L2.*L7.*m7.*cos(tht2).*cos(beta2+ ...
  tht7)+(-1).*L2.*m7.*sin(tht2).*((-1).*r74.*sin(beta1+tht7)+L7.* ...
  sin(beta2+tht7)),(-1).*L3.*L7.*m7.*cos(tht3).*cos(beta2+tht7)+(-1) ...
  .*L3.*m7.*sin(tht3).*((-1).*r74.*sin(beta1+tht7)+L7.*sin(beta2+ ...
  tht7)),(-1).*L7.*m7.*r74.*cos(beta1+tht4).*cos(beta2+tht7)+(-1).* ...
  L4.*L7.*m7.*cos(gamma2+tht4).*cos(beta2+tht7)+(-1).*L4.*m7.*sin( ...
  gamma2+tht4).*((-1).*r74.*sin(beta1+tht7)+L7.*sin(beta2+tht7)), ...
  L5.*L7.*m7.*cos(tht5).*cos(beta2+tht7)+L5.*m7.*sin(tht5).*((-1).* ...
  r74.*sin(beta1+tht7)+L7.*sin(beta2+tht7)),L6.*L7.*m7.*cos(tht6).* ...
  cos(beta2+tht7)+L6.*m7.*sin(tht6).*((-1).*r74.*sin(beta1+tht7)+ ...
  L7.*sin(beta2+tht7)),MI7+L7.^2.*m7.*cos(beta2+tht7).^2+(-1).*m7.* ...
  r74.*sin(beta1+tht7).*((-1).*r74.*sin(beta1+tht7)+L7.*sin(beta2+ ...
  tht7))+L7.*m7.*sin(beta2+tht7).*((-1).*r74.*sin(beta1+tht7)+L7.* ...
  sin(beta2+tht7))];





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

eig(Mmat)
issymmetric(Mmat)



%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% phi is for finding qddot with ext lambda calculation 
phi=[lam2+m1.*omg1.^2.*r1.*cos(tht1)+L2.*m1.*omg2.^2.*cos(tht2)+L2.* ...
  m5.*omg2.^2.*cos(tht2)+L2.*m6.*omg2.^2.*cos(tht2)+L2.*m7.* ...
  omg2.^2.*cos(tht2)+m2.*omg2.^2.*r2.*cos(tht2)+L3.*m1.*omg3.^2.* ...
  cos(tht3)+L3.*m2.*omg3.^2.*cos(tht3)+L3.*m5.*omg3.^2.*cos(tht3)+ ...
  L3.*m6.*omg3.^2.*cos(tht3)+L3.*m7.*omg3.^2.*cos(tht3)+m3.* ...
  omg3.^2.*r3.*cos(tht3)+m4.*omg4.^2.*r14.*cos(gamma1+tht4)+L4.*m1.* ...
  omg4.^2.*cos(gamma2+tht4)+L4.*m2.*omg4.^2.*cos(gamma2+tht4)+L4.* ...
  m3.*omg4.^2.*cos(gamma2+tht4)+L4.*m5.*omg4.^2.*cos(gamma2+tht4)+ ...
  L4.*m6.*omg4.^2.*cos(gamma2+tht4)+L4.*m7.*omg4.^2.*cos(gamma2+ ...
  tht4)+(-1).*L5.*m6.*omg5.^2.*cos(tht5)+(-1).*L5.*m7.*omg5.^2.*cos( ...
  tht5)+(-1).*m5.*omg5.^2.*r5.*cos(tht5)+(-1).*L6.*m7.*omg6.^2.*cos( ...
  tht6)+(-1).*m6.*omg6.^2.*r6.*cos(tht6)+m7.*omg7.^2.*r74.*cos( ...
  beta1+tht7)+(-1).*L7.*m7.*omg7.^2.*cos(beta2+tht7),lam1+m1.* ...
  omg1.^2.*r1.*sin(tht1)+L2.*m1.*omg2.^2.*sin(tht2)+L2.*m5.* ...
  omg2.^2.*sin(tht2)+L2.*m6.*omg2.^2.*sin(tht2)+L2.*m7.*omg2.^2.* ...
  sin(tht2)+m2.*omg2.^2.*r2.*sin(tht2)+L3.*m1.*omg3.^2.*sin(tht3)+ ...
  L3.*m2.*omg3.^2.*sin(tht3)+L3.*m5.*omg3.^2.*sin(tht3)+L3.*m6.* ...
  omg3.^2.*sin(tht3)+L3.*m7.*omg3.^2.*sin(tht3)+m3.*omg3.^2.*r3.* ...
  sin(tht3)+m7.*omg4.^2.*r74.*sin(beta1+tht4)+m4.*omg4.^2.*r14.*sin( ...
  gamma1+tht4)+L4.*m1.*omg4.^2.*sin(gamma2+tht4)+L4.*m2.*omg4.^2.* ...
  sin(gamma2+tht4)+L4.*m3.*omg4.^2.*sin(gamma2+tht4)+L4.*m5.* ...
  omg4.^2.*sin(gamma2+tht4)+L4.*m6.*omg4.^2.*sin(gamma2+tht4)+L4.* ...
  m7.*omg4.^2.*sin(gamma2+tht4)+(-1).*L5.*m6.*omg5.^2.*sin(tht5)+( ...
  -1).*L5.*m7.*omg5.^2.*sin(tht5)+(-1).*m5.*omg5.^2.*r5.*sin(tht5)+( ...
  -1).*L6.*m7.*omg6.^2.*sin(tht6)+(-1).*m6.*omg6.^2.*r6.*sin(tht6)+( ...
  -1).*L7.*m7.*omg7.^2.*sin(beta2+tht7),T1+(-1).*T5+(-1).*L2.*m1.* ...
  omg2.^2.*r1.*sin(tht1+(-1).*tht2)+(-1).*L3.*m1.*omg3.^2.*r1.*sin( ...
  tht1+(-1).*tht3)+L4.*m1.*omg4.^2.*r1.*sin(gamma2+(-1).*tht1+tht4), ...
  (-1).*T1+T2+L2.*m1.*omg1.^2.*r1.*sin(tht1+(-1).*tht2)+(-1).*L2.* ...
  L3.*m1.*omg3.^2.*sin(tht2+(-1).*tht3)+(-1).*L2.*L3.*m5.*omg3.^2.* ...
  sin(tht2+(-1).*tht3)+(-1).*L2.*L3.*m6.*omg3.^2.*sin(tht2+(-1).* ...
  tht3)+(-1).*L2.*L3.*m7.*omg3.^2.*sin(tht2+(-1).*tht3)+(-1).*L3.* ...
  m2.*omg3.^2.*r2.*sin(tht2+(-1).*tht3)+(1/2).*L2.*m7.*omg4.^2.* ...
  r74.*sin(beta1+(-1).*tht2+tht4)+L2.*L4.*m1.*omg4.^2.*sin(gamma2+( ...
  -1).*tht2+tht4)+L2.*L4.*m5.*omg4.^2.*sin(gamma2+(-1).*tht2+tht4)+ ...
  L2.*L4.*m6.*omg4.^2.*sin(gamma2+(-1).*tht2+tht4)+L2.*L4.*m7.* ...
  omg4.^2.*sin(gamma2+(-1).*tht2+tht4)+L4.*m2.*omg4.^2.*r2.*sin( ...
  gamma2+(-1).*tht2+tht4)+(1/2).*L2.*m7.*omg4.^2.*r74.*sin(beta1+ ...
  tht2+tht4)+L2.*L5.*m6.*omg5.^2.*sin(tht2+(-1).*tht5)+L2.*L5.*m7.* ...
  omg5.^2.*sin(tht2+(-1).*tht5)+L2.*m5.*omg5.^2.*r5.*sin(tht2+(-1).* ...
  tht5)+L2.*L6.*m7.*omg6.^2.*sin(tht2+(-1).*tht6)+L2.*m6.*omg6.^2.* ...
  r6.*sin(tht2+(-1).*tht6)+(1/2).*L2.*m7.*omg7.^2.*r74.*sin(beta1+( ...
  -1).*tht2+tht7)+(-1).*L2.*L7.*m7.*omg7.^2.*sin(beta2+(-1).*tht2+ ...
  tht7)+(-1/2).*L2.*m7.*omg7.^2.*r74.*sin(beta1+tht2+tht7),(-1).*T2+ ...
  T3+L3.*m1.*omg1.^2.*r1.*sin(tht1+(-1).*tht3)+L2.*L3.*m1.*omg2.^2.* ...
  sin(tht2+(-1).*tht3)+L2.*L3.*m5.*omg2.^2.*sin(tht2+(-1).*tht3)+ ...
  L2.*L3.*m6.*omg2.^2.*sin(tht2+(-1).*tht3)+L2.*L3.*m7.*omg2.^2.* ...
  sin(tht2+(-1).*tht3)+L3.*m2.*omg2.^2.*r2.*sin(tht2+(-1).*tht3)+( ...
  1/2).*L3.*m7.*omg4.^2.*r74.*sin(beta1+(-1).*tht3+tht4)+L3.*L4.* ...
  m1.*omg4.^2.*sin(gamma2+(-1).*tht3+tht4)+L3.*L4.*m2.*omg4.^2.*sin( ...
  gamma2+(-1).*tht3+tht4)+L3.*L4.*m5.*omg4.^2.*sin(gamma2+(-1).* ...
  tht3+tht4)+L3.*L4.*m6.*omg4.^2.*sin(gamma2+(-1).*tht3+tht4)+L3.* ...
  L4.*m7.*omg4.^2.*sin(gamma2+(-1).*tht3+tht4)+L4.*m3.*omg4.^2.*r3.* ...
  sin(gamma2+(-1).*tht3+tht4)+(1/2).*L3.*m7.*omg4.^2.*r74.*sin( ...
  beta1+tht3+tht4)+L3.*L5.*m6.*omg5.^2.*sin(tht3+(-1).*tht5)+L3.* ...
  L5.*m7.*omg5.^2.*sin(tht3+(-1).*tht5)+L3.*m5.*omg5.^2.*r5.*sin( ...
  tht3+(-1).*tht5)+L3.*L6.*m7.*omg6.^2.*sin(tht3+(-1).*tht6)+L3.* ...
  m6.*omg6.^2.*r6.*sin(tht3+(-1).*tht6)+(1/2).*L3.*m7.*omg7.^2.* ...
  r74.*sin(beta1+(-1).*tht3+tht7)+(-1).*L3.*L7.*m7.*omg7.^2.*sin( ...
  beta2+(-1).*tht3+tht7)+(-1/2).*L3.*m7.*omg7.^2.*r74.*sin(beta1+ ...
  tht3+tht7),(-1).*T3+T4+(-1).*T7+(1/2).*m7.*omg4.^2.*r74.^2.*sin( ...
  2.*(beta1+tht4))+(-1).*L4.*m1.*omg1.^2.*r1.*sin(gamma2+(-1).*tht1+ ...
  tht4)+(-1/2).*L2.*m7.*omg2.^2.*r74.*sin(beta1+(-1).*tht2+tht4)+( ...
  -1).*L2.*L4.*m1.*omg2.^2.*sin(gamma2+(-1).*tht2+tht4)+(-1).*L2.* ...
  L4.*m5.*omg2.^2.*sin(gamma2+(-1).*tht2+tht4)+(-1).*L2.*L4.*m6.* ...
  omg2.^2.*sin(gamma2+(-1).*tht2+tht4)+(-1).*L2.*L4.*m7.*omg2.^2.* ...
  sin(gamma2+(-1).*tht2+tht4)+(-1).*L4.*m2.*omg2.^2.*r2.*sin(gamma2+ ...
  (-1).*tht2+tht4)+(1/2).*L2.*m7.*omg2.^2.*r74.*sin(beta1+tht2+tht4) ...
  +(-1/2).*L3.*m7.*omg3.^2.*r74.*sin(beta1+(-1).*tht3+tht4)+(-1).* ...
  L3.*L4.*m1.*omg3.^2.*sin(gamma2+(-1).*tht3+tht4)+(-1).*L3.*L4.* ...
  m2.*omg3.^2.*sin(gamma2+(-1).*tht3+tht4)+(-1).*L3.*L4.*m5.* ...
  omg3.^2.*sin(gamma2+(-1).*tht3+tht4)+(-1).*L3.*L4.*m6.*omg3.^2.* ...
  sin(gamma2+(-1).*tht3+tht4)+(-1).*L3.*L4.*m7.*omg3.^2.*sin(gamma2+ ...
  (-1).*tht3+tht4)+(-1).*L4.*m3.*omg3.^2.*r3.*sin(gamma2+(-1).*tht3+ ...
  tht4)+(1/2).*L3.*m7.*omg3.^2.*r74.*sin(beta1+tht3+tht4)+L4.*m7.* ...
  omg4.^2.*r74.*sin(beta1+gamma2+2.*tht4)+(1/2).*L5.*m7.*omg5.^2.* ...
  r74.*sin(beta1+tht4+(-1).*tht5)+L4.*L5.*m6.*omg5.^2.*sin(gamma2+ ...
  tht4+(-1).*tht5)+L4.*L5.*m7.*omg5.^2.*sin(gamma2+tht4+(-1).*tht5)+ ...
  L4.*m5.*omg5.^2.*r5.*sin(gamma2+tht4+(-1).*tht5)+(-1/2).*L5.*m7.* ...
  omg5.^2.*r74.*sin(beta1+tht4+tht5)+(1/2).*L6.*m7.*omg6.^2.*r74.* ...
  sin(beta1+tht4+(-1).*tht6)+L4.*L6.*m7.*omg6.^2.*sin(gamma2+tht4+( ...
  -1).*tht6)+L4.*m6.*omg6.^2.*r6.*sin(gamma2+tht4+(-1).*tht6)+(-1/2) ...
  .*L6.*m7.*omg6.^2.*r74.*sin(beta1+tht4+tht6)+(1/2).*L7.*m7.* ...
  omg7.^2.*r74.*sin(beta1+(-1).*beta2+tht4+(-1).*tht7)+(1/2).*L4.* ...
  m7.*omg7.^2.*r74.*sin(beta1+(-1).*gamma2+(-1).*tht4+tht7)+(-1).* ...
  L4.*L7.*m7.*omg7.^2.*sin(beta2+(-1).*gamma2+(-1).*tht4+tht7)+( ...
  -1/2).*L7.*m7.*omg7.^2.*r74.*sin(beta1+beta2+tht4+tht7)+(-1/2).* ...
  L4.*m7.*omg7.^2.*r74.*sin(beta1+gamma2+tht4+tht7),T5+(-1).*T6+(-1) ...
  .*L2.*L5.*m6.*omg2.^2.*sin(tht2+(-1).*tht5)+(-1).*L2.*L5.*m7.* ...
  omg2.^2.*sin(tht2+(-1).*tht5)+(-1).*L2.*m5.*omg2.^2.*r5.*sin(tht2+ ...
  (-1).*tht5)+(-1).*L3.*L5.*m6.*omg3.^2.*sin(tht3+(-1).*tht5)+(-1).* ...
  L3.*L5.*m7.*omg3.^2.*sin(tht3+(-1).*tht5)+(-1).*L3.*m5.*omg3.^2.* ...
  r5.*sin(tht3+(-1).*tht5)+(-1/2).*L5.*m7.*omg4.^2.*r74.*sin(beta1+ ...
  tht4+(-1).*tht5)+(-1).*L4.*L5.*m6.*omg4.^2.*sin(gamma2+tht4+(-1).* ...
  tht5)+(-1).*L4.*L5.*m7.*omg4.^2.*sin(gamma2+tht4+(-1).*tht5)+(-1) ...
  .*L4.*m5.*omg4.^2.*r5.*sin(gamma2+tht4+(-1).*tht5)+(-1/2).*L5.* ...
  m7.*omg4.^2.*r74.*sin(beta1+tht4+tht5)+(-1).*L5.*L6.*m7.*omg6.^2.* ...
  sin(tht5+(-1).*tht6)+(-1).*L5.*m6.*omg6.^2.*r6.*sin(tht5+(-1).* ...
  tht6)+(-1/2).*L5.*m7.*omg7.^2.*r74.*sin(beta1+(-1).*tht5+tht7)+ ...
  L5.*L7.*m7.*omg7.^2.*sin(beta2+(-1).*tht5+tht7)+(1/2).*L5.*m7.* ...
  omg7.^2.*r74.*sin(beta1+tht5+tht7),T6+(-1).*L2.*L6.*m7.*omg2.^2.* ...
  sin(tht2+(-1).*tht6)+(-1).*L2.*m6.*omg2.^2.*r6.*sin(tht2+(-1).* ...
  tht6)+(-1).*L3.*L6.*m7.*omg3.^2.*sin(tht3+(-1).*tht6)+(-1).*L3.* ...
  m6.*omg3.^2.*r6.*sin(tht3+(-1).*tht6)+(-1/2).*L6.*m7.*omg4.^2.* ...
  r74.*sin(beta1+tht4+(-1).*tht6)+(-1).*L4.*L6.*m7.*omg4.^2.*sin( ...
  gamma2+tht4+(-1).*tht6)+(-1).*L4.*m6.*omg4.^2.*r6.*sin(gamma2+ ...
  tht4+(-1).*tht6)+L5.*L6.*m7.*omg5.^2.*sin(tht5+(-1).*tht6)+L5.* ...
  m6.*omg5.^2.*r6.*sin(tht5+(-1).*tht6)+(-1/2).*L6.*m7.*omg4.^2.* ...
  r74.*sin(beta1+tht4+tht6)+(-1/2).*L6.*m7.*omg7.^2.*r74.*sin(beta1+ ...
  (-1).*tht6+tht7)+L6.*L7.*m7.*omg7.^2.*sin(beta2+(-1).*tht6+tht7)+( ...
  1/2).*L6.*m7.*omg7.^2.*r74.*sin(beta1+tht6+tht7),T7+(-1).*L2.*L7.* ...
  m7.*omg2.^2.*cos(beta2+tht7).*sin(tht2)+(-1).*L3.*L7.*m7.* ...
  omg3.^2.*cos(beta2+tht7).*sin(tht3)+(-1).*L7.*m7.*omg4.^2.*r74.* ...
  cos(beta2+tht7).*sin(beta1+tht4)+(-1).*L4.*L7.*m7.*omg4.^2.*cos( ...
  beta2+tht7).*sin(gamma2+tht4)+L5.*L7.*m7.*omg5.^2.*cos(beta2+tht7) ...
  .*sin(tht5)+L6.*L7.*m7.*omg6.^2.*cos(beta2+tht7).*sin(tht6)+ ...
  L7.^2.*m7.*omg7.^2.*cos(beta2+tht7).*sin(beta2+tht7)+L2.*m7.* ...
  omg2.^2.*cos(tht2).*((-1).*r74.*sin(beta1+tht7)+L7.*sin(beta2+ ...
  tht7))+L3.*m7.*omg3.^2.*cos(tht3).*((-1).*r74.*sin(beta1+tht7)+ ...
  L7.*sin(beta2+tht7))+L4.*m7.*omg4.^2.*cos(gamma2+tht4).*((-1).* ...
  r74.*sin(beta1+tht7)+L7.*sin(beta2+tht7))+(-1).*L5.*m7.*omg5.^2.* ...
  cos(tht5).*((-1).*r74.*sin(beta1+tht7)+L7.*sin(beta2+tht7))+(-1).* ...
  L6.*m7.*omg6.^2.*cos(tht6).*((-1).*r74.*sin(beta1+tht7)+L7.*sin( ...
  beta2+tht7))+m7.*omg7.^2.*r74.*cos(beta1+tht7).*((-1).*r74.*sin( ...
  beta1+tht7)+L7.*sin(beta2+tht7))+(-1).*L7.*m7.*omg7.^2.*cos(beta2+ ...
  tht7).*((-1).*r74.*sin(beta1+tht7)+L7.*sin(beta2+tht7))];

%{
%%%%%%%%%%%%%%%%%%%%%%%
inv(Mmat);
qddot = Mmat\phi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%rhs1 = rhs;
%Cn  = Cmat;
%rhs2 = Gd';


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%rhs2 -gn
%%rhs1 - phi
%Mmat
invM = inv(Mmat)

%Gmat = Cn*invM*Cn';
%invG = inv(Gmat);

%nr  = Gd' - Cn*invM*rhs1';
%P1 = Gd' ;
%P2 = Cn*invM*rhs1';
%lam = Gmat\( Gd'- Cn*invM*rhs1')

%lam = [lam1;lam2;lam3;lam4]
%(Cn'*lam + rhs1')
%qddot_invdy = invM*(Cn'*lam + rhs1');
%}

% qddot = qddot_invdy

phi;
qddot_invdy = invM*phi'
%qddot_invdy(4) = 0
af =qddot_invdy ;
%qddot = [omg1;omg2;omg3;omg4;omg5;omg6;omg7;vhx;vhy;qddot_invdy]
 qddot = qddot_invdy;
 %lamx = lam2 + lam4;
 %lamy = lam1 + lam3;
% lamx = lamt;
% lamy = lamn;

end






 






